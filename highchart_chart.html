<!DOCTYPE html>
<html>

<head>
    <link href="https://fonts.googleapis.com/css?family=Montserrat%7CPaytone+One&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css"
        integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous">
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <link rel="stylesheet" href="hw2_style.css">
    <title>Tianran's Dingus & Widget</title>
    <meta charset="UTF-8">
</head>

<body onload="ok(); wtf(); okk()">
    <main>
        <div class="header">
            <img src="logo.png" alt="logo" />
            <header>
                <h1>Global Dashboard</h1>
            </header>
        </div>

        <hr>

        <div class="container">
            <div class='column'>
                <h3>Dingus</h3>
                <p id="dingus">3</p>
            </div>
            <div class='column'>
                <h3>Widget</h3>
                <p id="widget">3</p>
            </div>
            <div class='column'>
                <h3>Sales</h3>
                <p>
                    <span style='color:green'>$</span>
                    <span id="tot" style='color:blue'>72.72</span>
                </p>
            </div>
        </div>
        <hr>

        <figure class="highcharts-figure1">
            <div id="container1" style="width:49%"></div>
        </figure>

        <figure class="highcharts-figure2">
            <div id="container2" style="width:49%"></div>
        </figure>
        <script>
            Highcharts.chart('container1', {
                chart: {
                    type: 'bar',
                    reflow: true
                },
                title: {
                    text: 'Stacked bar chart'
                },
                xAxis: {
                    categories: [1,2]
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'Dingus and Widget Sales Per Day'
                    }
                },
                legend: {
                    reversed: true
                },
                plotOptions: {
                    series: {
                        stacking: 'percent'
                    }
                },
                series: [{
                    name: 'Dingus',
                    data: [1,2]
                }, {
                    name: 'Widget',
                    data: [1,2]
                }]
            })

                Highcharts.chart('container2', {
                    chart: {
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false,
                        type: 'pie',
                        reflow: true
                    },
                    title: {
                        text: 'Dingus vs. Widget Sold Number Ratio'
                    },
                    tooltip: {
                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    accessibility: {
                        point: {
                            valueSuffix: '%'
                        }
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}</b>: {point.percentage:.1f} %'
                            }
                        }
                    },
                    series: [{
                        name: 'Brands',
                        colorByPoint: true,
                        data: [{
                            name: 'Dingus',
                            y: 50,
                            sliced: true,
                            selected: true
                        }, {
                            name: 'Widget',
                            y: 50
                        }]
                    }]
                })
        </script>
    

        <script>
            function wtf(){
                loader = JSON.parse(localStorage["orderHistory"]);
                let history = loader.orderHistory;
                var data = [[1, '01/01/2020', 1, 1], [2, '01/02/2020', 2, 2]];
                for (var i = 0; i < history.length; i++) {
                    data.push(history[i]);
                }
                if (data.length > 7) {
                    data = data.slice(data.length - 7, data.length);
                }
                var item = [];
                var one = [];
                var two = [];
                for(let i = 0; i < data.length; i++){
                    item.push(data[i][0]);
                    one.push(Number(data[i][2]));
                    two.push(Number(data[i][3]));
                }
                Highcharts.chart('container1', {
                chart: {
                    type: 'bar',
                    reflow: true
                },
                title: {
                    text: 'Stacked bar chart'
                },
                xAxis: {
                    categories: item
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'Dingus and Widget Sales Per Day'
                    }
                },
                legend: {
                    reversed: true
                },
                plotOptions: {
                    series: {
                        stacking: 'percent'
                    }
                },
                series: [{
                    name: 'Dingus',
                    data: one
                }, {
                    name: 'Widget',
                    data: two
                }]
            })

                Highcharts.chart('container2', {
                    chart: {
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false,
                        type: 'pie',
                        reflow: true
                    },
                    title: {
                        text: 'Dingus vs. Widget Sold Number Ratio'
                    },
                    tooltip: {
                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    accessibility: {
                        point: {
                            valueSuffix: '%'
                        }
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}</b>: {point.percentage:.1f} %'
                            }
                        }
                    },
                    series: [{
                        name: 'Brands',
                        colorByPoint: true,
                        data: [{
                            name: 'Dingus',
                            y: Number(document.getElementById("dingus").innerHTML),
                            sliced: true,
                            selected: true
                        }, {
                            name: 'Widget',
                            y: Number(document.getElementById("widget").innerHTML)
                        }]
                    }]
                })
            }

            function okk() {

                let tot_dingus = Number(document.getElementById("dingus").innerHTML);
                let tot_widget = Number(document.getElementById("widget").innerHTML);
                let tot_num = tot_dingus + tot_widget;

                let circum = 130 * 3.14
                let k = circum / tot_num;
                let circle_dingus = document.getElementById("dinp");
                let circle_widget = document.getElementById("widp");

                let dingus_dash = tot_dingus / tot_num * circum + ' ' + (circum - tot_dingus / tot_num * circum);
                let widget_dash = tot_widget / tot_num * circum + ' ' + (circum - tot_widget / tot_num * circum);
                circle_widget.style.strokeDasharray = widget_dash;
                let dinc = document.getElementById("dinc");
                let widc = document.getElementById("widc");
                dinc.innerHTML = (tot_dingus / tot_num * 100).toFixed(2) + "%";
                widc.innerHTML = (tot_widget / tot_num * 100).toFixed(2) + "%";
            }
        </script>


        <table id="myTable" class="tg">
            <caption>Order History</caption>
            <tr>
                <th class="tg-6qw1" rowspan="2">ID#</th>
                <th class="tg-baqh" rowspan="2">Date</th>
                <th class="tg-baqh" colspan="2">Quantity</th>
                <th class="tg-baqh" rowspan="2">Total</th>
            </tr>
            <tr>
                <th class="tg-baqh">Dingus</th>
                <th class="tg-baqh">Widget</th>
            </tr>
            <tbody>
            </tbody>

            <script>
                // Constants
                //localStorage.clear()
                const DINGUS_PRICE = 14.25;
                const WIDGET_PRICE = 9.99;
                const ZERO_FORMAT = '0.00';
                const DEBUG = true; // Where might this flag be used? (It's not mandatory)

                // Global store (What else would you need here?)
                let store = {
                    orderHistory: []
                };

                function generateEntries() {
                    // Returns an orderHistory array
                    // [ID#, Date, Dingus quantity, Widget quantity]
                    return [
                        [1, '01/01/2020', 1, 1],
                        [2, '01/02/2020', 2, 2]
                    ]
                }
                var result = generateEntries();
                var table = document.getElementById("myTable");
                var counter = 2;
                var din = 0;
                var wid = 0;
                var total = 0;
                var id;
                function insert(result) {
                    var i;
                    for (i = 0; i < result.length; i++) {
                        var di = result[i][2];
                        var wi = result[i][3];
                        id = counter - 1
                        var row = table.insertRow(counter);
                        var c1 = row.insertCell(0);
                        var c2 = row.insertCell(1);
                        var c3 = row.insertCell(2);
                        var c4 = row.insertCell(3);
                        var c5 = row.insertCell(4);
                        c1.style.backgroundColor = "#b6b3b3";
                        c1.innerHTML = id;
                        c2.innerHTML = result[i][1];
                        c3.innerHTML = di;
                        c4.innerHTML = wi;
                        to = Number(result[i][2] * DINGUS_PRICE + result[i][3] * WIDGET_PRICE).toFixed(2);
                        c5.innerHTML = to;
                        din = din + Number(result[i][2]);
                        wid = wid + Number(result[i][3]);
                        total = total + Number(result[i][2] * DINGUS_PRICE + result[i][3] * WIDGET_PRICE);
                        document.getElementById("dingus").innerHTML = din;
                        document.getElementById("widget").innerHTML = wid;
                        document.getElementById("tot").innerHTML = total.toFixed(2);

                        if (id > 2) {
                            row = [id, result[i][1], di, wi, Number(result[i][2] * DINGUS_PRICE + result[i][3] * WIDGET_PRICE).toFixed(2), din, wid, total];
                            store.orderHistory.push(row);
                            localStorage.setItem('orderHistory', JSON.stringify(store));
                            console.log('orderHistory');
                        }
                        counter = counter + 1
                    }
                    document.getElementById('button').disabled = true;
                }

                insert(result);
                function ok() {
                    var index = 4;
                    store = JSON.parse(localStorage['orderHistory']);
                    let orders = store.orderHistory;
                    for (i = 0; i < orders.length; i++) {
                        var row = table.insertRow(index);
                        var c1 = row.insertCell(0);
                        var c2 = row.insertCell(1);
                        var c3 = row.insertCell(2);
                        var c4 = row.insertCell(3);
                        var c5 = row.insertCell(4);
                        c1.innerHTML = orders[i][0];
                        c1.style.backgroundColor = "#b6b3b3";
                        c2.innerHTML = orders[i][1];
                        c3.innerHTML = orders[i][2];
                        c4.innerHTML = orders[i][3];
                        c5.innerHTML = orders[i][4];
                        din = orders[i][5];
                        wid = orders[i][6];
                        total = orders[i][7];
                        document.getElementById("dingus").innerHTML = orders[i][5];
                        document.getElementById("widget").innerHTML = orders[i][6];
                        document.getElementById("tot").innerHTML = orders[i][7].toFixed(2);
                        index = index + 1;
                    }
                    counter = orders.length + 4;
                }

                function push() {
                    var today = new Date();
                    var dd = String(today.getDate()).padStart(2, '0');
                    var mm = String(today.getMonth() + 1).padStart(2, '0');
                    var yyyy = today.getFullYear();
                    today = mm + '/' + dd + '/' + yyyy;
                    num1 = document.getElementById("num1").value;
                    dingus = dingus + num1;
                    num2 = document.getElementById("num2").value;
                    widget = widget + num2;
                    row = [[0, today, num1, num2, (num1 * DINGUS_PRICE + num2 * WIDGET_PRICE).toFixed(2)]];
                    insert(row);
                    document.getElementById("myForm").reset();
                }

            </script>

            <tfoot>
                <tr>
                    <td class="tg-6qw1" colspan="5">©2020 D&W Worldwide.</td>
                </tr>
            </tfoot>
        </table>
        <br>

        <div class="order">
            <details>
                <summary onclick='showDialog()'>Order Form</summary>
                <dialog id='dialog'></dialog>
                <hr>
                <form class=pure-form id="myForm">
                    <script>
                        function calc1() {
                            var v1 = document.getElementById("num1").value;
                            var d = document.getElementById("dp").value;
                            document.getElementById("totald").value = v1 * d;
                            var v2 = document.getElementById("num2").value;
                            var w = document.getElementById("wp").value;
                            document.getElementById("tt").value = (v1 * d + parseInt(v2 * 1) * w).toFixed(2);
                            document.getElementById('button').disabled = false;
                        }

                        function calc2() {
                            var v2 = document.getElementById("num2").value;
                            var w = document.getElementById("wp").value;
                            document.getElementById("totalw").value = v2 * w;
                            var v1 = document.getElementById("num1").value;
                            var d = document.getElementById("dp").value;
                            document.getElementById("tt").value = (v2 * w + parseInt(v1 * 1) * d).toFixed(2);
                            document.getElementById('button').disabled = false;
                        }
                    </script>

                    <label>
                        Dingus <input id="num1" value=0 onkeyup="calc1()">
                    </label>
                    <label>
                        @ <input id="dp" value=14.25 readonly="readonly">
                    </label>
                    <label>
                        =$ <input id="totald" value=0.00 onkeyup="calc1()" readonly="readonly">
                    </label>
                    <br>
                    <br>
                    <label>
                        Widget <input id="num2" value=0 onkeyup="calc2()">
                    </label>
                    <label>
                        @ <input id="wp" value=9.99 readonly="readonly">
                    </label>
                    <label>
                        =$ <input id="totalw" value=0.00 onkeyup="calc2()" readonly="readonly">
                    </label>
                    <br>
                    <br>
                    <label>
                        Total $ <input id="tt" value=0.00 readonly="readonly">
                    </label>
                    <br>
                    <br>

                    <script>
                        function cancel() {
                            document.getElementById("myForm").reset();
                        }
                    </script>

                    <button class="button-error pure-button" type="button" onclick="cancel()">Cancel</button>
                    <button class="button-success pure-button" type="button" id="button"
                        onclick="push();wtf();okk();cancel();insert()" disabled>Order</button>
                </form>
            </details>
            <br>
            <br>
        </div>
    </main>
</body>

</html>